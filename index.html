<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LedgerLift Studio - FAQ Chat</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        #root {
            width: 100%;
            max-width: 800px;
        }

        .chatbot-container {
            background: white;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            height: 90vh;
            max-height: 800px;
        }

        .chatbot-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .header-icon {
            width: 50px;
            height: 50px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
        }

        .header-text h1 {
            font-size: 1.4em;
            margin-bottom: 3px;
        }

        .header-text p {
            font-size: 0.9em;
            opacity: 0.9;
        }

        .back-button {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 0.9em;
            font-weight: 500;
            transition: all 0.2s;
        }

        .back-button:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .chatbot-body {
            flex: 1;
            background: #f7fafc;
            padding: 25px;
            overflow-y: auto;
        }

        .chatbot-body::-webkit-scrollbar {
            width: 8px;
        }

        .chatbot-body::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        .chatbot-body::-webkit-scrollbar-thumb {
            background: #667eea;
            border-radius: 4px;
        }

        .message {
            margin-bottom: 20px;
            display: flex;
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message.bot {
            justify-content: flex-start;
        }

        .message.user {
            justify-content: flex-end;
        }

        .message-bubble {
            padding: 15px 20px;
            border-radius: 18px;
            max-width: 80%;
            font-size: 0.95em;
            line-height: 1.6;
        }

        .message.bot .message-bubble {
            background: white;
            color: #2d3748;
            border: 1px solid #e2e8f0;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .message.user .message-bubble {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .quick-buttons {
            display: grid;
            gap: 12px;
            margin-top: 20px;
        }

        .quick-button {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 14px;
            padding: 18px;
            text-align: left;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .quick-button:hover {
            border-color: #667eea;
            background: #f0f4ff;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
        }

        .quick-button-icon {
            font-size: 28px;
            min-width: 35px;
        }

        .quick-button-text strong {
            display: block;
            color: #2d3748;
            margin-bottom: 3px;
            font-size: 1em;
        }

        .quick-button-text small {
            color: #718096;
            font-size: 0.85em;
        }

        .message-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-top: 15px;
        }

        .message-option-btn {
            background: white;
            border: 2px solid #667eea;
            color: #667eea;
            padding: 12px 18px;
            border-radius: 12px;
            font-size: 0.9em;
            cursor: pointer;
            transition: all 0.2s;
            text-align: left;
            font-weight: 500;
        }

        .message-option-btn:hover {
            background: #667eea;
            color: white;
            transform: translateX(5px);
        }

        .cta-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .cta-btn {
            padding: 12px 20px;
            border-radius: 12px;
            font-size: 0.9em;
            cursor: pointer;
            border: none;
            transition: all 0.2s;
            font-weight: 600;
        }

        .cta-btn.primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .cta-btn.secondary {
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
        }

        .cta-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(102, 126, 234, 0.3);
        }

        /* NEW: Email Capture Styles */
        .email-capture {
            margin-top: 20px;
            padding: 20px;
            background: #f0f4ff;
            border-radius: 14px;
            border: 2px solid #667eea;
        }

        .email-capture h3 {
            color: #2d3748;
            font-size: 1em;
            margin-bottom: 15px;
        }

        .email-capture-form {
            display: flex;
            gap: 10px;
        }

        .email-capture input {
            flex: 1;
            padding: 12px 16px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            font-size: 0.9em;
            outline: none;
        }

        .email-capture input:focus {
            border-color: #667eea;
        }

        .email-capture button {
            padding: 12px 24px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .email-capture button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .email-capture button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .email-capture .success-message {
            color: #48bb78;
            font-weight: 600;
            text-align: center;
            padding: 12px;
        }

        .chatbot-input {
            background: white;
            padding: 20px;
            border-top: 1px solid #e2e8f0;
            display: flex;
            gap: 12px;
        }

        .chatbot-input input {
            flex: 1;
            padding: 15px 20px;
            border: 2px solid #e2e8f0;
            border-radius: 30px;
            font-size: 0.95em;
            outline: none;
            transition: border-color 0.2s;
        }

        .chatbot-input input:focus {
            border-color: #667eea;
        }

        .chatbot-input button {
            padding: 15px 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 30px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .chatbot-input button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(102, 126, 234, 0.4);
        }

        .chatbot-input button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .typing-indicator {
            display: flex;
            gap: 6px;
            padding: 5px 0;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background: #667eea;
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing {
            0%, 60%, 100% {
                transform: translateY(0);
            }
            30% {
                transform: translateY(-10px);
            }
        }

        @media (max-width: 600px) {
            .chatbot-container {
                height: 100vh;
                max-height: none;
                border-radius: 0;
            }

            .chatbot-header {
                padding: 20px;
            }

            .message-bubble {
                max-width: 90%;
            }

            .email-capture-form {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // CONFIGURATION: Set your Make.com webhook URL here
        const MAKE_WEBHOOK_URL = 'https://hook.us1.make.com/b37ou4y72fnod6xcntv075q51s3i5ve0'; // Replace this before deploying

        // Q&A Database (unchanged from original)
        const QA_DATABASE = {
            products: {
                title: 'ðŸ“¦ Products & Templates',
                description: 'Learn about our digital products',
                questions: [
                    {
                        q: 'What products do you offer?',
                        a: 'We offer affordable DIY finance tools designed specifically for bootstrap founders:\n\n**Digital Templates ($7-$99):**\nâ€¢ Cash Flow Template\nâ€¢ Financial Level Assessment Tool\nâ€¢ Bookkeeping Quickstart Guide\nâ€¢ Compliance Checklist Bundle\n\n**Done-For-You Services:**\nâ€¢ Bookkeeping Reset ($997)\nâ€¢ Monthly Subscriptions ($97-$697)\n\nEach product is tailored to your current Financial Level (1-5).',
                        ctas: [
                            { text: 'View All Products', url: 'https://stan.store/ledgerliftstudio', primary: true }
                        ]
                    },
                    {
                        q: 'What is the Bookkeeping Reset service?',
                        a: '**Bookkeeping Reset** is our signature 14-day cleanup service for founders who are behind on their books.\n\n**What\'s included:**\nâ€¢ Complete catch-up bookkeeping (up to 12 months)\nâ€¢ Chart of accounts optimization\nâ€¢ Bank reconciliation\nâ€¢ QuickBooks/Xero setup\nâ€¢ Financial reports package (P&L, Balance Sheet, Cash Flow)\nâ€¢ 1-hour wrap call with recommendations\n\n**Price:** $997 (fixed, all-inclusive)\n**Perfect for:** Level 2-3 founders ($50K-$300K revenue)',
                        ctas: [
                            { text: 'Book Free Diagnostic Call', url: 'https://cal.com/ledgerliftstudio/diagnostic', primary: true },
                            { text: 'Learn More', url: 'https://stan.store/ledgerliftstudio', primary: false }
                        ]
                    }
                ]
            },
            pricing: {
                title: 'ðŸ’° Pricing',
                description: 'Understand our pricing structure',
                questions: [
                    {
                        q: 'How much do your services cost?',
                        a: 'Our pricing is designed to be affordable for bootstrap founders at every stage:\n\n**Templates:** $7-$99 (one-time)\n**Bookkeeping Reset:** $997 (one-time, 14-day service)\n**Monthly Basic:** $97/month\n**Monthly Standard:** $297/month\n**CFO Service:** $697/month\n\nðŸ’¡ We recommend what you actually need based on your Financial Levelâ€”no overselling!',
                        ctas: [
                            { text: 'Take Free Quiz', url: 'https://stan.store/ledgerliftstudio/p/-free-find-your-journey-level-quiz', primary: true }
                        ]
                    },
                    {
                        q: 'Do you offer payment plans?',
                        a: 'For the **Bookkeeping Reset** ($997), we offer:\nâ€¢ 50% upfront ($498.50)\nâ€¢ 50% on completion ($498.50)\n\n**Monthly services** are billed monthly with no long-term contractsâ€”cancel anytime!\n\n**Templates** are one-time purchases (no payment plans needed for small amounts).',
                        ctas: [
                            { text: 'Book Diagnostic Call', url: 'https://cal.com/ledgerliftstudio/diagnostic', primary: true }
                        ]
                    }
                ]
            },
            levels: {
                title: 'ðŸŽ¯ Journey Levels',
                description: 'Understand the 5 Financial Levels',
                questions: [
                    {
                        q: 'What are the 5 Financial Levels?',
                        a: 'The **5 Financial Levels Framework** helps you identify where you are and what you need next:\n\n**Level 1 ($0-$50K):** DIY with templates\n**Level 2 ($50K-$150K):** Need cleanup/reset\n**Level 3 ($150K-$300K):** Need ongoing support\n**Level 4 ($300K-$500K):** Need CFO guidance\n**Level 5 ($500K+):** Need full financial team\n\nKnowing your level helps you invest in the RIGHT solutionâ€”not too little, not too much.',
                        ctas: [
                            { text: 'Find Your Level (Free Quiz)', url: 'https://stan.store/ledgerliftstudio/p/-free-find-your-journey-level-quiz', primary: true }
                        ]
                    },
                    {
                        q: 'How do I know which level I\'m at?',
                        a: 'Take our **free 2-minute assessment**! It asks about:\nâ€¢ Your current revenue\nâ€¢ How you handle bookkeeping now\nâ€¢ Your biggest challenges\nâ€¢ What you need help with\n\nYou\'ll get instant results showing your Financial Level plus a personalized action plan.',
                        ctas: [
                            { text: 'Take the Quiz Now', url: 'https://stan.store/ledgerliftstudio/p/-free-find-your-journey-level-quiz', primary: true }
                        ]
                    }
                ]
            },
            getting_started: {
                title: 'ðŸš€ Getting Started',
                description: 'How to work with us',
                questions: [
                    {
                        q: 'How do I get started?',
                        a: 'Getting started is easy! Here\'s the process:\n\n**Step 1:** Take the free Financial Level Quiz (2 minutes)\n**Step 2:** Book a free 15-minute diagnostic call\n**Step 3:** Get your personalized recommendation\n**Step 4:** Choose your solution (template, service, or subscription)\n\n**No pressure, no pitchâ€”just clarity on what you actually need.**',
                        ctas: [
                            { text: 'Book Free Call', url: 'https://cal.com/ledgerliftstudio/diagnostic', primary: true },
                            { text: 'Take Quiz First', url: 'https://stan.store/ledgerliftstudio/p/-free-find-your-journey-level-quiz', primary: false }
                        ]
                    },
                    {
                        q: 'What is a diagnostic call?',
                        a: '**Diagnostic Call Details:**\nâ€¢ **Duration:** 15 minutes\nâ€¢ **Cost:** Free\nâ€¢ **Format:** Zoom video call\nâ€¢ **What we cover:**\n  - Your current bookkeeping situation\n  - Identify your Financial Level\n  - Show you exactly what\'s broken\n  - Recommend the right solution\n\n**No pitch. Just clarity.** You\'ll walk away knowing exactly what you need to do next.',
                        ctas: [
                            { text: 'Book Your Free Call', url: 'https://cal.com/ledgerliftstudio/diagnostic', primary: true }
                        ]
                    }
                ]
            }
        };

        // Main Chatbot Component
        function Chatbot() {
            const [messages, setMessages] = useState([
                {
                    type: 'bot',
                    content: 'ðŸ‘‹ Hi! I\'m here to answer your questions about LedgerLift Studio products, pricing, and the Journey Level system.\n\nWhat would you like to know?',
                    showCategories: true
                }
            ]);
            const [inputValue, setInputValue] = useState('');
            const [isTyping, setIsTyping] = useState(false);
            const [emailCaptured, setEmailCaptured] = useState(false);
            const [conversationData, setConversationData] = useState({
                questionsAsked: [],
                ctasClicked: [],
                estimatedLevel: null,
                startTime: new Date().toISOString()
            });
            const messagesEndRef = useRef(null);

            const scrollToBottom = () => {
                messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
            };

            useEffect(() => {
                scrollToBottom();
            }, [messages]);

            // NEW: Send data to Make.com
            const sendToMake = async (data) => {
                if (MAKE_WEBHOOK_URL === 'YOUR_MAKE_WEBHOOK_URL_HERE') {
                    console.log('Make.com webhook not configured. Data:', data);
                    return;
                }

                try {
                    await fetch(MAKE_WEBHOOK_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(data)
                    });
                } catch (error) {
                    console.error('Error sending to Make.com:', error);
                }
            };

            // NEW: Estimate Financial Level based on questions asked
            const estimateFinancialLevel = (questions) => {
                const keywords = {
                    'level1': ['template', 'diy', 'starting', 'new'],
                    'level2': ['reset', 'cleanup', 'behind', 'mess'],
                    'level3': ['monthly', 'ongoing', 'support', 'regular'],
                    'level4': ['cfo', 'strategic', 'guidance', 'planning']
                };

                const scores = { level1: 0, level2: 0, level3: 0, level4: 0 };

                questions.forEach(q => {
                    const lowerQ = q.toLowerCase();
                    Object.keys(keywords).forEach(level => {
                        keywords[level].forEach(keyword => {
                            if (lowerQ.includes(keyword)) {
                                scores[level]++;
                            }
                        });
                    });
                });

                const maxScore = Math.max(...Object.values(scores));
                if (maxScore === 0) return 'Unknown';

                const estimatedLevel = Object.keys(scores).find(key => scores[key] === maxScore);
                return estimatedLevel.replace('level', 'Level ');
            };

            const addMessage = (type, content, options = {}) => {
                setMessages(prev => [...prev, { type, content, ...options }]);
            };

            const handleCategoryClick = (categoryKey) => {
                const category = QA_DATABASE[categoryKey];
                addMessage('user', category.title);
                
                // Track question
                setConversationData(prev => ({
                    ...prev,
                    questionsAsked: [...prev.questionsAsked, category.title]
                }));

                setIsTyping(true);
                setTimeout(() => {
                    setIsTyping(false);
                    addMessage('bot', `Great! What would you like to know about ${category.title.split(' ').slice(1).join(' ')}?`, {
                        questions: category.questions,
                        categoryTitle: category.title
                    });

                    // NEW: Show email capture after 2 bot responses
                    checkForEmailCapture();
                }, 800);
            };

            const handleQuestionClick = (question) => {
                addMessage('user', question.q);
                
                // Track question
                setConversationData(prev => ({
                    ...prev,
                    questionsAsked: [...prev.questionsAsked, question.q],
                    estimatedLevel: estimateFinancialLevel([...prev.questionsAsked, question.q])
                }));

                setIsTyping(true);
                setTimeout(() => {
                    setIsTyping(false);
                    addMessage('bot', question.a, {
                        ctas: question.ctas,
                        showRestartPrompt: true
                    });

                    // NEW: Show email capture after 2 bot responses
                    checkForEmailCapture();
                }, 1000);
            };

            // NEW: Check if we should show email capture
            const checkForEmailCapture = () => {
                const botMessages = messages.filter(m => m.type === 'bot').length;
                if (botMessages >= 2 && !emailCaptured) {
                    setTimeout(() => {
                        addMessage('bot', 'ðŸ’¡ Want a personalized Financial Level action plan sent to your email?', {
                            showEmailCapture: true
                        });
                    }, 1500);
                }
            };

            // NEW: Handle email submission
            const handleEmailSubmit = async (email) => {
                setEmailCaptured(true);

                // Send to Make.com
                await sendToMake({
                    type: 'email_captured',
                    email: email,
                    estimatedLevel: conversationData.estimatedLevel,
                    questionsAsked: conversationData.questionsAsked,
                    timestamp: new Date().toISOString()
                });

                addMessage('bot', 'âœ… Perfect! Check your email in the next few minutes for your personalized action plan.\n\nAnything else I can help with?', {
                    showCategories: true
                });
            };

            // NEW: Handle CTA clicks with tracking
            const handleCTAClick = async (cta) => {
                // Track CTA click
                setConversationData(prev => ({
                    ...prev,
                    ctasClicked: [...prev.ctasClicked, cta.text]
                }));

                // Send to Make.com
                await sendToMake({
                    type: 'cta_clicked',
                    ctaText: cta.text,
                    ctaUrl: cta.url,
                    estimatedLevel: conversationData.estimatedLevel,
                    questionsAsked: conversationData.questionsAsked,
                    timestamp: new Date().toISOString()
                });

                window.open(cta.url, '_blank');
            };

            const handleUserInput = () => {
                if (!inputValue.trim()) return;

                const userQuestion = inputValue;
                addMessage('user', userQuestion);
                setInputValue('');

                // Track question
                setConversationData(prev => ({
                    ...prev,
                    questionsAsked: [...prev.questionsAsked, userQuestion],
                    estimatedLevel: estimateFinancialLevel([...prev.questionsAsked, userQuestion])
                }));

                setIsTyping(true);
                setTimeout(() => {
                    setIsTyping(false);
                    
                    // Simple keyword matching
                    const lowerQuestion = userQuestion.toLowerCase();
                    let foundAnswer = null;

                    // Search through all categories for matching questions
                    Object.values(QA_DATABASE).forEach(category => {
                        category.questions.forEach(qa => {
                            if (lowerQuestion.includes(qa.q.toLowerCase().split(' ').slice(0, 3).join(' '))) {
                                foundAnswer = qa;
                            }
                        });
                    });

                    if (foundAnswer) {
                        addMessage('bot', foundAnswer.a, {
                            ctas: foundAnswer.ctas,
                            showRestartPrompt: true
                        });
                    } else {
                        addMessage('bot', `I don't have a pre-written answer for that specific question, but I'd be happy to help!\n\nðŸ“§ Please email us at hello@ledgerliftstudio.com and we'll get back to you within 24 hours.\n\nOr, try selecting a category above to see if your question is covered there!`, {
                            showCategories: true
                        });
                    }

                    // Check for email capture
                    checkForEmailCapture();
                }, 1000);
            };

            const handleKeyPress = (e) => {
                if (e.key === 'Enter') {
                    handleUserInput();
                }
            };

            return (
                <div className="chatbot-container">
                    <div className="chatbot-header">
                        <div className="header-left">
                            <div className="header-icon">ðŸ’¬</div>
                            <div className="header-text">
                                <h1>LedgerLift Studio</h1>
                                <p>We're here to help! âœ¨</p>
                            </div>
                        </div>
                        <button 
                            className="back-button"
                            onClick={() => window.open('https://stan.store/ledgerliftstudio', '_blank')}
                        >
                            Back to Store
                        </button>
                    </div>

                    <div className="chatbot-body">
                        {messages.map((message, index) => (
                            <div key={index} className={`message ${message.type}`}>
                                <div className="message-bubble">
                                    {message.content.split('\n').map((line, i) => (
                                        <React.Fragment key={i}>
                                            {line.includes('**') ? (
                                                <strong>{line.replace(/\*\*/g, '')}</strong>
                                            ) : (
                                                line
                                            )}
                                            {i < message.content.split('\n').length - 1 && <br />}
                                        </React.Fragment>
                                    ))}

                                    {message.showCategories && (
                                        <div className="quick-buttons">
                                            {Object.entries(QA_DATABASE).map(([key, category]) => (
                                                <div
                                                    key={key}
                                                    className="quick-button"
                                                    onClick={() => handleCategoryClick(key)}
                                                >
                                                    <span className="quick-button-icon">
                                                        {category.title.split(' ')[0]}
                                                    </span>
                                                    <div className="quick-button-text">
                                                        <strong>{category.title.split(' ').slice(1).join(' ')}</strong>
                                                        <small>{category.description}</small>
                                                    </div>
                                                </div>
                                            ))}
                                        </div>
                                    )}

                                    {message.questions && (
                                        <div className="message-options">
                                            {message.questions.map((q, i) => (
                                                <button
                                                    key={i}
                                                    className="message-option-btn"
                                                    onClick={() => handleQuestionClick(q)}
                                                >
                                                    â†’ {q.q}
                                                </button>
                                            ))}
                                        </div>
                                    )}

                                    {message.ctas && message.ctas.length > 0 && (
                                        <div className="cta-buttons">
                                            {message.ctas.map((cta, i) => (
                                                <button
                                                    key={i}
                                                    className={`cta-btn ${cta.primary ? 'primary' : 'secondary'}`}
                                                    onClick={() => handleCTAClick(cta)}
                                                >
                                                    {cta.text}
                                                </button>
                                            ))}
                                        </div>
                                    )}

                                    {/* NEW: Email Capture Component */}
                                    {message.showEmailCapture && !emailCaptured && (
                                        <EmailCapture onSubmit={handleEmailSubmit} />
                                    )}
                                </div>
                            </div>
                        ))}

                        {isTyping && (
                            <div className="message bot">
                                <div className="message-bubble">
                                    <div className="typing-indicator">
                                        <div className="typing-dot"></div>
                                        <div className="typing-dot"></div>
                                        <div className="typing-dot"></div>
                                    </div>
                                </div>
                            </div>
                        )}

                        <div ref={messagesEndRef} />
                    </div>

                    <div className="chatbot-input">
                        <input
                            type="text"
                            placeholder="Or type your question here..."
                            value={inputValue}
                            onChange={(e) => setInputValue(e.target.value)}
                            onKeyPress={handleKeyPress}
                        />
                        <button onClick={handleUserInput} disabled={!inputValue.trim()}>
                            Send
                        </button>
                    </div>
                </div>
            );
        }

        // NEW: Email Capture Component
        function EmailCapture({ onSubmit }) {
            const [email, setEmail] = useState('');
            const [submitted, setSubmitted] = useState(false);

            const handleSubmit = (e) => {
                e.preventDefault();
                if (email && email.includes('@')) {
                    setSubmitted(true);
                    onSubmit(email);
                }
            };

            if (submitted) {
                return (
                    <div className="email-capture">
                        <div className="success-message">âœ… Sent! Check your email.</div>
                    </div>
                );
            }

            return (
                <div className="email-capture">
                    <h3>ðŸ“§ Get Your Personalized Action Plan</h3>
                    <form className="email-capture-form" onSubmit={handleSubmit}>
                        <input
                            type="email"
                            placeholder="your@email.com"
                            value={email}
                            onChange={(e) => setEmail(e.target.value)}
                            required
                        />
                        <button type="submit" disabled={!email.includes('@')}>
                            Send It
                        </button>
                    </form>
                </div>
            );
        }

        // Render the app
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<Chatbot />);
    </script>
</body>
</html>
